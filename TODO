************************************************************************
* Official mandoc TODO.
* $Id: TODO,v 1.73 2011/01/06 14:05:12 kristaps Exp $
************************************************************************

************************************************************************
* parser bugs
************************************************************************

- the roff parser doesn't tolerate additional characters between
  a macro and the \} terminating a conditional block, e.g.
  .if n \{
  .br \}
  reported by ulrich spoerlein  Tue, 19 Oct 2010 20:39:50 +0200

************************************************************************
* formatter bugs
************************************************************************

- in literal mode, the man(7) -Tascii formatter
  breaks the line between macro arguments,
  e.g. ".B #include <libintl.h>" in gettext(3)

************************************************************************
* missing features
************************************************************************

- pod2man expects `tr' to be implemented for \*(-- to work

- fix bad block nesting involving multiple identical explicit blocks
  see the OpenBSD mdoc_macro.c 1.47 commit message

- .Bl -column .Xo support is missing
  ultimate goal:
  restore .Xr and .Dv to
  lib/libc/compat-43/sigvec.3
  lib/libc/gen/signal.3
  lib/libc/sys/sigaction.2

- edge case: decide how to deal with blk_full bad nesting, e.g.
  .Sh .Nm .Bk .Nm .Ek .Sh found by jmc@ in ssh-keygen(1)
  from jmc@  Wed, 14 Jul 2010 18:10:32 +0100

- \\ is now implemented correctly
  * when defining strings and macros using .ds and .de
  * when parsing roff(7) and man(7) macro arguments
  It does not yet work in mdoc(7) macro arguments
  because libmdoc does not yet use mandoc_getarg().
  Also check what happens in plain text, it must be identical to \e.

- implement basic non-parametric .de to support e.g. sox(1)
  reported by naddy@ Sat, 16 Oct 2010 23:51:57 +0200
  *** sox(1) still doesn't work, tbl(1) errors need investigation

- clean up escape sequence handling, creating three classes:
  (1) fully implemented, or parsed and ignored without loss of content
  (2) unimplemented, potentially causing loss of content
      or serious mangling of formatting (e.g. \n) -> ERROR
      see textproc/mgdiff(1) for nice examples
  (3) undefined, just output the character -> perhaps WARNING

- look at pages generated from reStructeredText, e.g. devel/mercurial hg(1)
  These are a weird mixture of man(7) and custom autogenerated low-level
  roff stuff.  Figure out to what extent we can cope.
  noted by stsp@  Sat, 24 Apr 2010 09:17:55 +0200
  reminded by nicm@  Mon, 3 May 2010 09:52:41 +0100

- implement blank `Bl -column', such as
  .Bl -column
  .It foo Ta bar
  .El

- explicitly disallow nested `Bl -column', which would clobber internal
  flags defined for struct mdoc_macro

- inside `.Bl -column' phrases, punctuation is handled like normal
  text, e.g. `.Bl -column .It Fl x . Ta ...' should give "-x -."

- inside `.Bl -column' phrases, TERMP_IGNDELIM handling by `Pf'
  is not safe, e.g. `.Bl -column .It Pf a b .' gives "ab."
  but should give "ab ."

- set a meaningful default if no `Bl' list type is assigned

- have a blank `It' head for `Bl -tag' not puke

- prohibit `Nm' from having non-text HEAD children
  (e.g., NetBSD mDNSShared/dns-sd.1)
  (mdoc_html.c and mdoc_term.c `Nm' handlers can be slightly simplified)

- xloadimage(1) wants .ti (temporary indent), rep by naddy@

- bashbug(1) complains "line scope broken" after
  .SM
  .B something
  should either just work or be a warning
  reported by naddy@

- check compatibility with Plan9:
  http://swtch.com/usr/local/plan9/tmac/tmac.an
  http://swtch.com/plan9port/man/man7/man.html
  "Anthony J. Bentley" <anthonyjbentley@gmail.com> 28 Dec 2010 21:58:40 -0700

************************************************************************
* formatting issues: ugly output
************************************************************************

- double quotes inside double quotes are escaped by doubling them
  implement this in mdoc(7), too
  so far, we only have it in roff(7) and man(7)
  reminded by millert@  Thu, 09 Dec 2010 17:29:52 -0500

- perl(1) SYNOPSIS looks bad; reported by deraadt@
  1) man(7) seems to need SYNOPSIS .Nm blocks, too

- In .Bl -column,
  .It Em Authentication<tab>Key Length
  ought to render "Key Length" with emphasis, too,
  see OpenBSD iked.conf(5).

- empty phrases in .Bl column produce too few blanks
  try e.g. .Bl -column It Ta Ta
  reported by millert Fri, 02 Apr 2010 16:13:46 -0400

- in enclosures, mandoc sometimes fancies a bogus end of sentence
  reminded by jmc@  Thu, 23 Sep 2010 18:13:39 +0059

************************************************************************
* formatting issues: gratuitious differences
************************************************************************

- .Rv (and probably .Ex) print different text if an `Nm' has been named
  or not (run a manual without `Nm blah' to see this).  I'm not sure
  that this exists in the wild, but it's still an error.

- In .Bl -bullet, the groff bullet is "+\b+\bo\bo", the mandoc bullet
  is just "o\bo".
  see for example OpenBSD ksh(1)

- The characters "|" and "\*(Ba" should never be bold,
  not even in the middle of a word, e.g. ".Cm b\*(Bac" in
  "mknod [-m mode] name b|c major minor"
  in OpenBSD ksh(1)

- A bogus .Pp between two .It must not produce a double blank line,
  see between -R and -r in OpenBSD rm(1), before "update" in mount(8),
  or in DIAGNOSTICS in init(8).
  Also have `It' complain if `Pp' is invoked at certain times (not
  -compact?).

- .Nx 1.0a
  should be "NetBSD 1.0A", not "NetBSD 1.0a",
  see OpenBSD ccdconfig(8).

- In .Bl -tag, if a tag exceeds the right margin and must be continued
  on the next line, it must be indented by -width, not width+1;
  see "rule block|pass" in OpenBSD ifconfig(8).

- The \& zero-width character counts as output.
  That is, when it is alone on a line between two .Pp,
  we want three blank lines, not two as in mandoc.

- When .Fn arguments exceed one output line, all but the first
  should be indented, see e.g. rpc(3);
  reported by jmc@ on discuss@  Fri, 29 Oct 2010 13:48:33 +0100

- Header lines of excessive length:
  Port OpenBSD man_term.c rev. 1.25 to mdoc_term.c
  and document it in mdoc(7) and man(7) COMPATIBILITY
  found while talking to Chris Bennett

************************************************************************
* performance issues
************************************************************************

Several areas can be cleaned up to make mandoc even faster.  These are 

- improve hashing mechanism for macros (quite important: performance)

- improve hashing mechanism for characters (not as important)

- the PDF file is HUGE: this can be reduced by using relative offsets

************************************************************************
* structural issues
************************************************************************

- Find better ways to prevent endless loops
  in roff(7) macro and string expansion.
  
