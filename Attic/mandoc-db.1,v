head	1.6;
access;
symbols
	VERSION_1_11_1:1.1;
locks; strict;
comment	@# @;


1.6
date	2011.05.13.00.42.26;	author kristaps;	state dead;
branches;
next	1.5;

1.5
date	2011.05.04.20.43.38;	author kristaps;	state Exp;
branches;
next	1.4;

1.4
date	2011.05.03.14.39.27;	author kristaps;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.28.10.44.02;	author kristaps;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.11.23.01.44;	author kristaps;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.04.10.53.15;	author kristaps;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Rename mandoc-db to makewhatis.  On the suggestion of schwarze@@; I agree.
Add initial version notes.
@
text
@@


1.5
log
@Grok manual architecture in mandoc-db.c.
@
text
@a0 152
.\"	$Id: mandoc-db.1,v 1.4 2011/05/03 14:39:27 kristaps Exp $
.\"
.\" Copyright (c) 2011 Kristaps Dzonsons <kristaps@@bsd.lv>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: May 3 2011 $
.Dt MANDOC-DB 1
.Os
.Sh NAME
.Nm mandoc-db
.Nd index UNIX manuals
.Sh SYNOPSIS
.Nm
.Op Fl d Ar dir
.Ar
.Sh DESCRIPTION
The
.Nm
utility extracts keywords from
.Ux
manuals and indexes them for fast retrieval.
The arguments are as follows:
.Bl -tag -width Ds
.It Fl d Ar dir
The directory into which to write the keyword and index databases.
.It Ar
Read input from zero or more files in
.Xr mdoc 7
or
.Xr man 7
.Ux
manual format.
.El
.Pp
By default,
.Nm
constructs the
.Sx Index Database
and
.Sx Keyword Database
in the current working directory.
.Pp
If fatal parse errors are encountered, the offending file is printed to
stderr, omitted from the index, and the parse continues with the next
input file.
.Ss Index Database
The index database,
.Pa mandoc.index ,
is a
.Xr recno 3
database with record values consisting of
.Pp
.Bl -enum -compact
.It
a nil-terminated filename,
.It
a nil-terminated manual section,
.It
a nil-terminated manual title,
.It
a nil-terminated architecture
.Pq this is not often available
.It
and a nil-terminated description.
.El
.Pp
Both the manual section and description may be zero-length.
Entries are sequentially-numbered, but the filenames are unordered.
.Ss Keyword Database
The keyword database,
.Pa mandoc.db ,
is a
.Xr btree 3
database of nil-terminated keywords (record length is non-zero string
length plus one) mapping to a 8-byte binary field consisting of the
keyword type and source
.Sx Index Database
record number.
The type, an unsigned 32-bit integer in host order, is one of the
following:
.Pp
.Bl -tag -width Ds -offset indent -compact
.It Li 0x01
The name of a manual page as given in the NAME section.
.It Li 0x02
A function prototype name as given in the SYNOPSIS section.
.It Li 0x03
A utility name as given in the SYNOPSIS section.
.It Li 0x04
An include file as given in the SYNOPSIS section.
.It Li 0x05
A variable name as given in the SYNOPSIS section.
.It Li 0x06
A standard as given in the STANDARDS section.
.It Li 0x07
An author as given in the AUTHORS section.
.It Li 0x08
A configuration as given in the SYNOPSIS section.
.El
.Pp
If a value is encountered outside of this range, the database is
corrupt.
.Pp
The latter four bytes are a host-ordered record number within the
.Sx Index Database .
.Pp
The
.Nm
utility is
.Ud
.Sh FILES
.Bl -tag -width Ds
.It Pa mandoc.db
A
.Xr btree 3
keyword database mapping keywords to a type and file reference in
.Pa mandoc.index .
.It Pa mandoc.db~
Working copy of
.Pa mandoc.db .
.It Pa mandoc.index
A
.Xr recno 3
database of indexed file-names.
.It Pa mandoc.index~
Working copy of
.Pa mandoc.index .
.El
.Sh EXIT STATUS
.Ex -std
.Sh SEE ALSO
.Xr mandoc 1
.Sh AUTHORS
The
.Nm
utility was written by
.An Kristaps Dzonsons Aq kristaps@@bsd.lv .
.Sh CAVEATS
Only
.Xr mdoc 7
manuals are processed.
@


1.4
log
@Pick up authors in mandoc-db.
@
text
@d1 1
a1 1
.\"	$Id: mandoc-db.1,v 1.3 2011/04/28 10:44:02 kristaps Exp $
d17 1
a17 1
.Dd $Mdocdate: April 28 2011 $
d72 3
d108 2
@


1.3
log
@Let mandoc-db grok `St' tokens.
@
text
@d1 1
a1 1
.\"	$Id: mandoc-db.1,v 1.2 2011/04/11 23:01:44 kristaps Exp $
d17 1
a17 1
.Dd $Mdocdate: April 11 2011 $
d70 2
d103 2
@


1.2
log
@Updating mandoc-db manual page with new recno contents.
@
text
@d1 1
a1 1
.\"	$Id: mandoc-db.1,v 1.1 2011/04/04 10:53:15 kristaps Exp $
d17 1
a17 1
.Dd $Mdocdate: April 4 2011 $
d99 2
@


1.1
log
@Add manual page for mandoc-db (mostly to document the file format of
the generated index and keyword databases).  Add some documentation
within mandoc-db.c.
@
text
@d1 1
a1 1
.\"	$Id: mandoc.1,v 1.85 2011/02/09 10:03:02 kristaps Exp $
d17 1
a17 1
.Dd $Mdocdate$
d62 12
a73 3
database of nil-terminated filenames (record length is non-zero string
length plus one) passed to
.Nm .
@
